<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Victor Lao">
<meta name="dcterms.date" content="2022-09-01">

<title>Victor Lao’s Portfolio - Network Mapping the Most Influential Addresses Using DAI (2021)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-S4NG67LZ08"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-S4NG67LZ08', { 'anonymize_ip': true});
</script>
<link href="../../site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="../../site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="../../site_libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="../../site_libs/vis-9.1.0/vis-network.min.js"></script>
<script src="../../site_libs/visNetwork-binding-2.1.2/visNetwork.js"></script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Victor Lao’s Portfolio</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About Me</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../listings.html"> 
<span class="menu-text">Reports</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../Resume.pdf"> 
<span class="menu-text">Resume</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Network Mapping the Most Influential Addresses Using DAI (2021)</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Victor Lao </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 1, 2022</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Decentralized Autonomous Organizations (DAO) use the blockchain to conduct transparent corporate operations. One of the most successful DAOs to date is MakerDAO. Their staying power in the tumultuous environment of crypto is largely attributed to the wide adoption of their overcollateralized backed USD stable coin, DAI.</p>
<p>All blockchain transactions are public and pseudonymous. This gives unprecedented public transparency to the inner workings of blockchain based businesses and their products. In this report, I extract all DAI specific transfers of value and map influential addresses in an interactive network using ggraph and visNetwork to investigate key actors in the DAI ecosystem. I will outline my methodology and analyze the resultant networkmap.</p>
</section>
<section id="methodology" class="level2">
<h2 class="anchored" data-anchor-id="methodology">Methodology</h2>
<p>Using the MakerDAO events table I created, I subset all DAI events. Values were stored in BigQuery as hexadecimals because values were too large to store in BigQuery.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  makerdao_operations.dai_events_may2021to2022</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">PARTITION</span> <span class="kw">BY</span> <span class="dt">DATE</span> (</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  block_timestamp</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="kw">CLUSTER</span> <span class="kw">BY</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  makerdao_smartcontract,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  makerdao_function</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="kw">AS</span> (</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">SELECT</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    block_timestamp,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    makerdao_smartcontract,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    makerdao_function,</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    to_address <span class="kw">AS</span> transaction_sender,</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    from_address <span class="kw">AS</span> transaction_reciever,</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    sender <span class="kw">AS</span> event_sender,</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    reciever <span class="kw">AS</span> event_reciever,</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    eth_value,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">value</span>,</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    percision</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="kw">FROM</span> `ethereum<span class="op">-</span>explorer<span class="op">-</span><span class="fl">354118.</span>makerdao_operations.may2021to2022`</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="kw">WHERE</span> makerdao_smartcontract <span class="kw">IN</span> (</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">'DAI'</span>,</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">'DAIJOIN'</span>,</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">'GEMJOIN'</span>,</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">'JUG'</span>,</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">'POT'</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The subset table was imported into R and converted into decimal form according to the event specific degree of precision.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#clean data from extracted from google bigquery</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read.csv</span>(</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> <span class="st">'dai_events_may2021to2022.csv'</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">header =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">colClasses =</span> <span class="fu">c</span>(<span class="st">"Date"</span>, <span class="st">"character"</span>, <span class="st">"character"</span>, <span class="st">"character"</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"character"</span>, <span class="st">"numeric"</span>, <span class="st">"character"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ifelse</span> (percision <span class="sc">==</span> <span class="st">'wad'</span>, value<span class="sc">/</span><span class="fl">10e18</span>,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ifelse</span> (percision <span class="sc">==</span> <span class="st">'ray'</span>, value<span class="sc">/</span><span class="fl">10e27</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ifelse</span> (percision <span class="sc">==</span> <span class="st">'rad'</span>, value<span class="sc">/</span><span class="fl">10e45</span>, <span class="cn">NaN</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>percision)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, all transfer (of value) events pertaining to the DAI smartcontract were extracted.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#filter events to pull out only DAI transaction data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>dai_transactions <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(makerdao_smartcontract <span class="sc">==</span> <span class="st">'DAI'</span> <span class="sc">&amp;</span> </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    makerdao_function <span class="sc">==</span> <span class="st">'transfer'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Before mapping a network, data had to be transformed into a form readable by network mapping packages. The node list was formed from unique senders and receivers. The edge list was formed from all transactions between unique addresses. Multiple transactions between the same addresses were counted as ‘weight’. Total transaction value was summed for each unique address pair.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#create node list (list of nodes with corresponding IDs)</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>node_list <span class="ot">&lt;-</span> dai_transactions <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(sender) <span class="sc">%&gt;%</span> </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(<span class="fu">distinct</span>(dai_transactions, reciever), </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"sender"</span> <span class="ot">=</span> <span class="st">"reciever"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>(<span class="st">"id"</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">#check node list</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>node_list</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">#create edge list with count as weight and add value column</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>edge_list <span class="ot">&lt;-</span> dai_transactions <span class="sc">%&gt;%</span> </span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sender, reciever) <span class="sc">%&gt;%</span> </span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">weight =</span> <span class="fu">n</span>(), <span class="at">amount =</span> <span class="fu">sum</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co">#convert edge list addresses into id specified in node_list</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>edge_list_byid <span class="ot">&lt;-</span> edge_list <span class="sc">%&gt;%</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(node_list, <span class="at">by =</span> <span class="st">"sender"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">from =</span> id) <span class="sc">%&gt;%</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(node_list, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"reciever"</span> <span class="ot">=</span> <span class="st">"sender"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">to =</span> id) <span class="sc">%&gt;%</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(from, to, weight, amount)</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="co">#check converted edge_list then remove original</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>edge_list_byid</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It is not uncommon for a user to have multiple accounts which can skew network analysis if not accounted for. To alleviate the effects of this, I used the infomap algorithm to cluster addresses into communities. The rationale was that most alternate accounts would closely transact with each other forming distinct clusters. The infomap algorithm was used as it takes into account edge (trade) direction. In order to identified key nodes in the network, addresses’ eigenvector centrality was calculated using trade frequency as a weight.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#using the node_list and edge_list_byid we can create a</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#graph object</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>graph <span class="ot">&lt;-</span> <span class="fu">tbl_graph</span>(<span class="at">nodes =</span> node_list, <span class="at">edges =</span> edge_list_byid, </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">directed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">#cluster nodes to find communities and centralities and rewrite graph object</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>graph <span class="ot">&lt;-</span> graph <span class="sc">%&gt;%</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">activate</span>(nodes) <span class="sc">%&gt;%</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">community =</span> <span class="fu">group_infomap</span>(<span class="at">weights =</span> weight)) <span class="sc">%&gt;%</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">centrality =</span> <span class="fu">centrality_eigen</span>(<span class="at">weights =</span> weight, <span class="at">directed =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As the DAI transaction dataset consists of over 1,500,000 transactions, addresses (nodes) were filtered for unique transaction pairs (edges) that were in the top 50% quantile for total transaction amount. Low value transacting nodes are unlikely to be key to the network. As I am looking for important actors in the network, I selected for the top 0.1% of addresses by eigenvector centrality. The selected addresses were collapsed on their communities.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#filter graph by centrality to reduce size by trimming data to visualize, value amount filtered to remove low value actors</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#note this also reduces community sizing as low value actors are excluded</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>filtered_graph <span class="ot">&lt;-</span> graph <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">activate</span>(edges) <span class="sc">%&gt;%</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(amount <span class="sc">&gt;</span> <span class="fu">quantile</span>(amount, <span class="fl">0.50</span>), weight <span class="sc">&gt;</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">activate</span>(nodes) <span class="sc">%&gt;%</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(centrality <span class="sc">&gt;</span> <span class="fu">quantile</span>(centrality, <span class="fl">0.999</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">node_is_isolated</span>())</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">#network is too large to be visualized so it will be contracted on its communities, weight and value will be summed</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>contracted_graph <span class="ot">&lt;-</span> filtered_graph <span class="sc">%&gt;%</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">activate</span>(nodes) <span class="sc">%&gt;%</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">convert</span>(to_contracted, community) <span class="sc">%&gt;%</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">activate</span>(nodes) <span class="sc">%&gt;%</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">community_size =</span> <span class="fu">map_dbl</span>(.orig_data, <span class="sc">~</span> <span class="fu">nrow</span>(.x))) <span class="sc">%&gt;%</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">activate</span>(edges) <span class="sc">%&gt;%</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">contracted_weight =</span> <span class="fu">map_dbl</span>(.orig_data, <span class="sc">~</span> <span class="fu">sum</span>(.x<span class="sc">$</span>weight)), </span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">contracted_amount =</span> <span class="fu">map_dbl</span>(.orig_data, <span class="sc">~</span> <span class="fu">sum</span>(.x<span class="sc">$</span>amount)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>contracted_graph <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"contracted_graph.rds"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>contracted_graph</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>This graph was created by an old(er) igraph version.
  Call upgrade_graph() on it to use with the current igraph version
  For now we convert it on the fly...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tbl_graph: 184 nodes and 968 edges
#
# A directed simple graph with 1 component
#
# Edge Data: 968 × 6 (active)
    from    to .tidygraph_edge_index .orig_data        contracted_weight
   &lt;int&gt; &lt;int&gt; &lt;list&gt;                &lt;list&gt;                        &lt;dbl&gt;
 1     1     2 &lt;int [45]&gt;            &lt;tibble [45 × 4]&gt;             61537
 2     1     3 &lt;int [4]&gt;             &lt;tibble [4 × 4]&gt;               1777
 3     1     4 &lt;int [20]&gt;            &lt;tibble [20 × 4]&gt;              5699
 4     1     5 &lt;int [2]&gt;             &lt;tibble [2 × 4]&gt;                332
 5     1     6 &lt;int [13]&gt;            &lt;tibble [13 × 4]&gt;              4668
 6     1     7 &lt;int [15]&gt;            &lt;tibble [15 × 4]&gt;             13995
 7     1     8 &lt;int [2]&gt;             &lt;tibble [2 × 4]&gt;                493
 8     1     9 &lt;int [8]&gt;             &lt;tibble [8 × 4]&gt;               3170
 9     1    10 &lt;int [12]&gt;            &lt;tibble [12 × 4]&gt;             14052
10     1    11 &lt;int [5]&gt;             &lt;tibble [5 × 4]&gt;               1281
# ℹ 958 more rows
# ℹ 1 more variable: contracted_amount &lt;dbl&gt;
#
# Node Data: 184 × 4
  community .orig_data        .tidygraph_node_index community_size
      &lt;int&gt; &lt;list&gt;            &lt;list&gt;                         &lt;dbl&gt;
1        56 &lt;tibble [95 × 3]&gt; &lt;int [95]&gt;                        95
2         8 &lt;tibble [4 × 3]&gt;  &lt;int [4]&gt;                          4
3        72 &lt;tibble [1 × 3]&gt;  &lt;int [1]&gt;                          1
# ℹ 181 more rows</code></pre>
</div>
</div>
<p>Resulting network was graphed using ggraph. Node radius reflected community size and color reflected degree of connections (darker blue representing a higher degree).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#graph network</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>network_graph <span class="ot">&lt;-</span> <span class="fu">ggraph</span>(contracted_graph, <span class="at">layout =</span> <span class="st">'igraph'</span>, <span class="at">algorithm =</span> <span class="st">'kk'</span>) <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link</span>(<span class="fu">aes</span>(<span class="at">edge_alpha =</span> contracted_weight, <span class="at">edge_colour =</span> contracted_amount)) <span class="sc">+</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_edge_colour_continuous</span>(<span class="at">high =</span> <span class="st">'#000000'</span>, <span class="at">low =</span> <span class="st">'#56B1F7'</span>) <span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> <span class="fu">sqrt</span>(community_size), <span class="at">colour =</span> <span class="fu">centrality_degree</span>())) <span class="sc">+</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_continuous</span>(<span class="at">high =</span> <span class="st">'#000000'</span>, <span class="at">low =</span> <span class="st">'#56B1F7'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="DaiTransfers_NetworkAnalysis_May2021to2022_Report_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Though some tentative conclusions may be made about the general network, there are too many nodes to pick out key addresses. Only the highest valued transaction pairs were selected to keep the map readable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#subset graph on value transacted to visualize high value connections (and importantly, visualize readable labels)</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>subset_graph <span class="ot">&lt;-</span> contracted_graph <span class="sc">%&gt;%</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">activate</span>(edges) <span class="sc">%&gt;%</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="dv">50</span>, contracted_amount) <span class="sc">%&gt;%</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">activate</span>(nodes) <span class="sc">%&gt;%</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">node_is_isolated</span>())</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>subset_network_graph <span class="ot">&lt;-</span> <span class="fu">ggraph</span>(subset_graph, <span class="at">layout =</span> <span class="st">'igraph'</span>, <span class="at">algorithm =</span> <span class="st">'kk'</span>) <span class="sc">+</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link</span>(<span class="fu">aes</span>(<span class="at">edge_alpha =</span> contracted_weight, <span class="at">edge_colour =</span> contracted_amount)) <span class="sc">+</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_edge_colour_continuous</span>(<span class="at">high =</span> <span class="st">'#000000'</span>, <span class="at">low =</span> <span class="st">'#56B1F7'</span>) <span class="sc">+</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> <span class="fu">sqrt</span>(community_size), <span class="at">colour =</span> <span class="fu">centrality_degree</span>())) <span class="sc">+</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_continuous</span>(<span class="at">high =</span> <span class="st">'#000000'</span>, <span class="at">low =</span> <span class="st">'#56B1F7'</span>) <span class="sc">+</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> community), <span class="at">position =</span> <span class="fu">position_nudge</span>(<span class="at">x =</span> <span class="fl">0.2</span>, <span class="at">y =</span> <span class="fl">0.2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="DaiTransfers_NetworkAnalysis_May2021to2022_Report_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Community 56 looked to be the most promising community and was thus graphed. As addresses are long and cumbersome to read, I thought an interactive visualization may be more user friendly. Before mapping in visNetwork, community 56 data had to be transformed into a format visNetwork would accept.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#prepare data for visualization of community 56 in order to display addresses (sender) in a readable way</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">#create color palette for groups</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>palette <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">brewer.pal</span>(<span class="dv">6</span>, <span class="st">'Set3'</span>))</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>vis_edge_list <span class="ot">&lt;-</span> community_56_graph <span class="sc">%&gt;%</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">activate</span>(edges) <span class="sc">%&gt;%</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(to)) <span class="sc">%&gt;%</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">arrows =</span> <span class="st">'to'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">title =</span> amount, <span class="at">value =</span> weight)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>vis_edge_list</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 86 × 5
    from    to value    title arrows
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;dbl&gt; &lt;chr&gt; 
 1    49    52     1 1200000  to    
 2    17    50    34 1614047. to    
 3    18    49    48 1403938. to    
 4    18    48     8  898990. to    
 5    18    47    20 1287273. to    
 6    18    46     3  836676. to    
 7    10    45    32  797796. to    
 8    17    44    20 2348153. to    
 9    17    43    53 1594078. to    
10    28    40    14 1570956. to    
# ℹ 76 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>vis_node_list <span class="ot">&lt;-</span> community_56_graph <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">activate</span>(nodes) <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">grouping =</span> <span class="fu">group_infomap</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>id, <span class="sc">-</span>community) <span class="sc">%&gt;%</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>(<span class="st">'id'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">title =</span> sender, <span class="at">value =</span> centrality) <span class="sc">%&gt;%</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="st">""</span>, <span class="at">color =</span> <span class="fu">case_when</span>(grouping <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">'#FB8072'</span>,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>                                       grouping <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">'#FFFFB3'</span>,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>                                       grouping <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">'#BEBADA'</span>,</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>                                       grouping <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">'#8DD3C7'</span>,</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>                                       grouping <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">'#80B1D3'</span>,</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>                                       grouping <span class="sc">==</span> <span class="dv">6</span> <span class="sc">~</span> <span class="st">'#FDB462'</span>))</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>vis_node_list</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 54 × 6
      id title                                        value grouping label color
   &lt;int&gt; &lt;chr&gt;                                        &lt;dbl&gt;    &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
 1     1 0x0000000000007f150bd6f54c40a34d7c3d5e9f56 5.98e-2        2 ""    #FFF…
 2     2 0xf7d9c9c06812c4a611a352ac82f638bdca6e09a8 2.00e-2        4 ""    #8DD…
 3     3 0xd0effc6828972483db1c64106f71d6ad12606a53 1.35e-2        4 ""    #8DD…
 4     4 0x2af33e93f68b8497bb535c492f5867c7e83f2bc4 4.82e-4        1 ""    #FB8…
 5     5 0xe592427a0aece92de3edee1f18e0157c05861564 4.47e-1        4 ""    #8DD…
 6     6 0x6c2d992b7739dfb363a473cc4f28998b7f1f6de2 2.19e-3        2 ""    #FFF…
 7     7 0x2a84e2bd2e961b1557d6e516ca647268b432cba4 9.11e-3        3 ""    #BEB…
 8     8 0x4a137fd5e7a256ef08a7de531a17d0be0cc7b6b6 1.65e-2        3 ""    #BEB…
 9     9 0x4d246be90c2f36730bb853ad41d0a189061192d3 2.61e-2        5 ""    #80B…
10    10 0xbf3f6477dbd514ef85b7d3ec6ac2205fd0962039 1.05e-2        1 ""    #FB8…
# ℹ 44 more rows</code></pre>
</div>
</div>
<p>Network was mapped so that addresses would display on node mouse over and total transaction value would display on edge mouse over. Click lights up one degree of edges.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#graph dynamic network with prepared data</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>dynamic_network_graph <span class="ot">&lt;-</span> <span class="fu">visNetwork</span>(vis_node_list, vis_edge_list, <span class="at">main =</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"Transaction Network of Top 1% Most Influential Addresses Using DAI"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visOptions</span>(<span class="at">highlightNearest =</span> <span class="fu">list</span>(<span class="at">enabled =</span> <span class="cn">TRUE</span>, <span class="at">degree =</span> <span class="fu">list</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visInteraction</span>(<span class="at">dragView =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visLayout</span>(<span class="at">randomSeed =</span> <span class="dv">11</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>dynamic_network_graph</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="visNetwork html-widget html-fill-item" id="htmlwidget-8872e7f0d83d7297ec0a" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-8872e7f0d83d7297ec0a">{"x":{"nodes":{"id":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54],"title":["0x0000000000007f150bd6f54c40a34d7c3d5e9f56","0xf7d9c9c06812c4a611a352ac82f638bdca6e09a8","0xd0effc6828972483db1c64106f71d6ad12606a53","0x2af33e93f68b8497bb535c492f5867c7e83f2bc4","0xe592427a0aece92de3edee1f18e0157c05861564","0x6c2d992b7739dfb363a473cc4f28998b7f1f6de2","0x2a84e2bd2e961b1557d6e516ca647268b432cba4","0x4a137fd5e7a256ef08a7de531a17d0be0cc7b6b6","0x4d246be90c2f36730bb853ad41d0a189061192d3","0xbf3f6477dbd514ef85b7d3ec6ac2205fd0962039","0x53e836dbb301dc78d73c8fff8014330bc5f21695","0x741aa7cfb2c7bf2a1e7d4da2e3df6a56ca4131f3","0x492f5e8b40da0b02742b658780483d9dfae13cb3","0x495f8ef80e13e9e1e77d60d2f384bb49694823ef","0x00000000008c4fb1c916e0c88fd4cc402d935e7d","0x000000000dfde7deaf24138722987c9a6991e2d4","0x220bda5c8994804ac96ebe4df184d25e5c2196d4","0x1111111254fb6c44bac0bed2854e76f90643097d","0x2057cfb9fd11837d61b294d514c5bd03e5e7189a","0x020d0886d0a1b55e9362f9b00095db5775c7754d","0xa91c2ceb9d2e343bfd5a12d5b3b3794346a8c473","0xcf2bb5dd1d0e175b7e13c5028f58fc4f5bfb99cb","0x68b3465833fb72a70ecdf485e0e4c7bd8665fc45","0xb65fc555b0e970b16329a48e45cfa14fce9a36a4","0xa8ecaf8745c56d5935c232d2c5b83b9cd3de1f6a","0x5d0eb3a4cada50e1a3668601834ce6039db87657","0xeef86c2e49e11345f1a693675df9a38f7d880c8f","0x7bfee91193d9df2ac0bfe90191d40f23c773c060","0x8474ddbe98f5aa3179b3b3f5942d724afcdec9f6","0x5097119dcb1ce3725dbcbe42356722dbacfc3b81","0xb6aab2b026752a971f8944a6aed371b74e2bc4f8","0x4f0a296cbfa854be4b97df5c1f36f5140f6297e5","0x13bb0ae230504a389989fd00df6dae9e2a873d5e","0x67c89126fb7e793a2fac54e0c4bd8baa53395767","0xeb5455590bb2bf67d54d7d3affaa1930c5132b14","0xc37704a457b1ee87eb657cae584a34961e86acac","0x61746f8673eea1c514696bc523ca991ff5864e77","0x1bf531eb5a835a05d1a60405159219230a0b4491","0xed99c6929bba505a2f1a65b9ca156a068fab6427","0x6db544e2a4464762c4df0876389c5357fa7a3a93","0xae33fb0ceb844559c638b23725f009e2f182c862","0xf9c342c85495ab28e5aeb875a8c53f4904556570","0xc73f6738311e76d45dfed155f39773e68251d251","0x45fd5af82a8af6d3f7117ebb8b2cfad72b27342b","0x1e3d6eab4bcf24bcd04721caa11c478a2e59852d","0x3cbc3bed185b837d79ba18d36a3859ecbcfc3dc8","0x8eb53edc3aa96c3f53dd401a57e875348270ee9a","0x408fead9c7943ba7deb3dc4f2f93f765455f177c","0xfe19b054f7b0cb7f4c051372ab2bd799472583cc","0x3d2fb958376ee1ca22322b2c226666e414c3cfdd","0x904a22dcbbfb961568312d5cce301bf165c2a1fb","0x0e8eb2232fc3fb0c10756cd65d7052987d6316f4","0xdb29ec3fb265a03943bfedbdf4ee9d9867b368e8","0x823332a8f6c0bc4c5fe8fb522c81aec9806334c3"],"value":[0.05980643734905251,0.01997097786792886,0.01349455746165161,0.0004819616561362171,0.4474012345398447,0.00218606079757462,0.009111905330649872,0.0164763074688632,0.02613830527813726,0.01047401582499265,0.001843800471773244,0.0003517224552759986,1.893824219276197e-05,0.004936259811916543,0.01868580962229003,0.001076691192016598,0.08711363282102544,0.02381828751543085,0.02257496351968594,0.0001505885825583969,0.0001123513509349599,9.776583804989638e-06,0.02128323536310385,0.003541804331298871,0.00254624309186905,9.931407793509197e-05,0.02147202905918462,0.0001882871219441402,6.110071426937037e-05,2.413825901578201e-05,8.559617651357478e-09,0.0008157224699278865,0.001091030926484381,2.625693308184818e-06,0.0001950325276329463,1.435929969290359e-05,0.0006970349235991003,5.183714053139728e-07,5.513310140841867e-05,5.54279564210723e-08,8.559617651357612e-09,2.573576815578531e-08,0.0002557255958036918,0.0001794668712365034,0.0004055531823241288,1.635345294941621e-05,1.001660950269289e-05,4.006643801077157e-06,3.787111022544926e-05,7.572113963510813e-05,5.008304751412708e-07,7.963211509551295e-10,2.740157364725337e-10,1.453657530644302e-07],"grouping":[2,4,4,1,4,2,3,3,5,1,5,1,2,3,6,3,1,1,1,1,1,1,1,1,1,3,1,1,1,5,1,2,2,1,6,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],"label":["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],"color":["#FFFFB3","#8DD3C7","#8DD3C7","#FB8072","#8DD3C7","#FFFFB3","#BEBADA","#BEBADA","#80B1D3","#FB8072","#80B1D3","#FB8072","#FFFFB3","#BEBADA","#FDB462","#BEBADA","#FB8072","#FB8072","#FB8072","#FB8072","#FB8072","#FB8072","#FB8072","#FB8072","#FB8072","#BEBADA","#FB8072","#FB8072","#FB8072","#80B1D3","#FB8072","#FFFFB3","#FFFFB3","#FB8072","#FDB462","#FB8072","#FFFFB3","#FB8072","#FB8072","#FB8072","#FB8072","#FB8072","#FB8072","#FB8072","#FB8072","#FB8072","#FB8072","#FB8072","#FB8072","#FB8072","#FB8072","#FB8072","#FB8072","#FB8072"]},"edges":{"from":[49,17,18,18,18,18,10,17,17,28,1,18,15,18,1,1,9,18,29,24,14,12,18,17,23,18,18,18,19,17,20,45,44,12,54,21,24,43,22,45,19,17,20,52,38,45,4,46,50,48,44,12,28,47,51,21,41,24,31,43,22,53,39,42,14,35,16,8,9,26,6,9,14,30,11,7,14,8,1,3,2,5,33,32,37,6],"to":[52,50,49,48,47,46,45,44,43,40,37,36,35,34,33,32,30,28,27,27,26,25,24,24,24,22,21,20,20,20,19,19,19,19,19,19,19,19,19,18,18,18,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,16,15,14,14,14,14,13,11,9,9,9,8,8,7,6,5,5,2,1,1,1,1],"value":[1,34,48,8,20,3,32,20,53,14,550,13,18,5,839,634,37,13,5,33,952,49,20,122,21,11,102,4,49,51,16,40,34,120,1,31,28,15,6,18,2467,6275,84,1,7,103,6,5,45,3,72,702,22,9,1,85,1,125,1,35,7,1,2,2,927,18,798,498,424,943,412,381,362,14,298,613,521,553,1598,721,1220,1352,775,624,470,1204],"title":[1200000,1614047.159229278,1403937.964295717,898990.4020584093,1287272.873,836676.1562514689,797795.6936864913,2348153.003665737,1594077.657013268,1570955.568434454,1999583.558647963,1378547.019688079,1491735.565665704,1139868.184366523,2085219.961961214,2184762.164529677,6180336.9,1126113.759781583,945007.333569781,704315.4838195679,939432.5267046499,569019.3432852827,636668.9297279607,4066551.651614505,746266.501517672,1466182.426273538,3395856.222641522,1388981.096614958,1212318.380039312,1793048.873873719,2233092.768960404,1049630.381322264,2598189.281597812,3117221.905905613,557676.2899957849,963168.3514535622,730198.0363417423,912280.1458320107,710771.3030444295,1073069.403522314,119396913.118397,249081227.7630924,4461947.189730315,1200000,686991.1313989572,2897240.868286249,613098.9107820933,1443645.465170832,1703862.493281704,708586.7004684093,5092223.889626971,20210639.1060596,1064045.054473721,1097229.529,600000,2183476.646559621,2564846.053455438,3641726.505022399,2582067.597095817,3241619.474542736,744080.4820025518,689019.8682904813,551519.8338709611,7582623.88246797,985310.0900692651,1491972.099508486,904946.5835416666,716557.7857899803,1005176.791416667,931265.5328672872,6977831.761078916,2099414.83,848673.1072661732,1742564.03873131,1635051.008239095,634789.4227160119,790953.4728946293,581287.2943183493,5948884.200340531,667360.590952612,851230.2244031765,603084.0802739642,1934142.344796383,2071697.990218653,1901669.582897861,5467716.070278578],"arrows":["to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot"},"manipulation":{"enabled":false},"interaction":{"dragView":false,"zoomSpeed":1},"layout":{"randomSeed":11}},"groups":["2","4","1","3","5","6"],"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":{"text":"Transaction Network of Top 1% Most Influential Addresses Using DAI","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":true,"hoverNearest":false,"degree":{"from":0,"to":1},"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":false,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="analysis" class="level2">
<h2 class="anchored" data-anchor-id="analysis">Analysis</h2>
<p>To determine if my analysis picked out key players in the the DAI ecosystem, I checked to see if there were any exchange addresses. I expect exchanges would be central to the network because they deal in high transaction volumes and values. Indeed, I found 0x220bda5c8994804ac96ebe4df184d25e5c2196d4 and 0x1111111254fb6c44bAC0beD2854e76F90643097d. Both are smart contracts of 1inch, a popular DeFi aggregator. Sushiswap’s MANA-DAI pool, 0x495F8Ef80E13e9E1e77d60d2f384bb49694823ef, was among the addresses visualized. And finally, Uniswap’s V3 router 0xe592427a0aece92de3edee1f18e0157c05861564 was also present.</p>
<p>The more unknown addresses provided interesting insight into the users that hold up DAI. 0x1e3D6eAb4BCF24bcD04721caA11C478a2e59852D is one such mysterious address. Activity on this address stopped around May 2021 but beforehand seemed involved in high frequency trading of renBTC and wBTC. One explanation may be that this address was an arbitrage trader transacting in BTC derived cryptos. Their high DAI transaction values may indicate they used DAI as an arbitrage currency. DAI allows for fee-less flash-loans (loans that are instantaneously paid) making it very permissive for arbitrage traders.</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<p>Almende B.V. and Contributors, Thieurmel B, Robert T (2021). visNetwork: Network Visualization using ‘vis.js’ Library. R package version 2.1.0, URL <a href="https://CRAN.R-project.org/package=visNetwork" class="uri">https://CRAN.R-project.org/package=visNetwork</a></p>
<p>Google (2021). BigQuery. URL <a href="https://cloud.google.com/bigquery" class="uri">https://cloud.google.com/bigquery</a></p>
<p>Neuwirth E (2022). RColorBrewer: ColorBrewer Palettes. R package version 1.1-3, URL <a href="https://CRAN.R-project.org/package=RColorBrewer" class="uri">https://CRAN.R-project.org/package=RColorBrewer</a></p>
<p>Pedersen T (2021). ggraph: An Implementation of Grammar of Graphics for Graphs and Networks. R package version 2.0.5, URL <a href="https://CRAN.R-project.org/package=ggraph" class="uri">https://CRAN.R-project.org/package=ggraph</a></p>
<p>Pedersen T (2022). tidygraph: A Tidy API for Graph Manipulation. R package version 1.2.1, URL <a href="https://CRAN.R-project.org/package=tidygraph" class="uri">https://CRAN.R-project.org/package=tidygraph</a></p>
<p>R Core Team (2021). R: A language and environment for statistical computing. R Foundation for Statistical Computing, Vienna, Austria. URL <a href="https://www.R-project.org/" class="uri">https://www.R-project.org/</a></p>
<p>Wickham et al., (2019). Welcome to the tidyverse. Journal of Open Source Software, 4(43), 1686, URL <a href="https://doi.org/10.21105/joss.01686" class="uri">https://doi.org/10.21105/joss.01686</a></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>